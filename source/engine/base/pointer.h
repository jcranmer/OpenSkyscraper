#ifndef OSS_ENGINE_BASE_POINTER_H
#define OSS_ENGINE_BASE_POINTER_H

#include "../external.h"


namespace OSS {
	template <class T> class Pointer {
		
		/**
		 * Construction
		 *
		 * The constructors reset the obj pointer to NULL. If an object or another Pointer in-
		 * stance is supplied, the overloaded assignment operator is used to set the pointer's
		 * value.
		 */
	protected:
		T* obj;
		
	public:
		//Constructs a pointer to NULL.
		Pointer() {
			assert((unsigned long)this > 0x1000000);
			obj = NULL;
		}
		
		//Constructs a pointer with a given pointer value.
		Pointer(T* o) {
			assert((unsigned long)this > 0x1000000);
			obj = NULL;
			*this = o;
		}
		
		//Constructs a pointer from another Pointer instance.
		Pointer(const Pointer<T>& p) {
			assert((unsigned long)this > 0x1000000);
			obj = NULL;
			*this = p;
		}
		
		//Destructs the pointer, releasing the object if there is one.
		~Pointer() {
			assert((unsigned long)this > 0x1000000);
			if (obj) obj->release();
		}
		
		
		/**
		 * Assignment
		 *
		 * Overloaded assignment operators that allow to use the instance as if it really was a
		 * pointer to the object.
		 */
	public:
		//Assign a pointer
		inline void operator =(T* o) {
			if (o) o->retain();
			if (obj) obj->release();
			obj = o;
		}
		
		//Assign another Pointer instance
		inline void operator =(const Pointer<T>& p) {
			if (p.obj) p.obj->retain();
			if (obj) obj->release();
			obj = p.obj;
		}
		
		
		/**
		 * Dereferencing
		 *
		 * Overloaded dereferencing operators that allow to use the instance as if it really was
		 * a pointer to the object.
		 */
	public:
		inline T& operator *() const {
			assert(obj != NULL && "tried to * on a NULL pointer");
			return *obj;
		}
		
		inline T* operator ->() const {
			assert(obj != NULL && "tried to -> on a NULL pointer");
			return obj;
		}
		
		
		/**
		 * Auto Typecast
		 *
		 * Makes the instance transparent and act as if it really was a pointer to the object.
		 */
	public:
		inline operator T*() const { return obj; }
		
		
		/**
		 * Logic
		 */
	public:
		inline bool operator !() { return !(obj); }
		inline bool operator ==(const Pointer<T>& p) const { return (obj == p.obj); }
		inline bool operator ==(const T* o) const { return (obj == o); }
	};
}


#endif
